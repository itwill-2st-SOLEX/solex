<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="kr.co.itwillbs.solex.code.CodeMapper">

	<!-- 공통코드 리스트 조회 -->
	<select id="getCodeList" resultType="kr.co.itwillbs.solex.code.CodeDTO">
		SELECT	*
		FROM	CODE
	</select>
	
	<!-- 무한스크롤 구현 -->
	<select id="selectPagedCodeList" resultType="kr.co.itwillbs.solex.code.CodeDTO">
		SELECT * FROM (
			SELECT t.*, ROWNUM rnum FROM (
				SELECT * FROM code
				<where>
					<if test="codYn != null and codYn != ''">
						cod_yn = #{codYn}
					</if>
				</where>
				<choose>
					<when test="sort != null and dir != null">
						ORDER BY ${sort} ${dir}
					</when>
				<otherwise>
					ORDER BY cod_id ASC
				</otherwise>
				</choose>
			) t
			WHERE ROWNUM &lt;= #{offset} + #{perPage}
		)
		WHERE rnum &gt; #{offset}
	</select>
	
	<select id="selectTotalCount" resultType="int">
		SELECT COUNT(*) FROM code
		<where>
			<if test="codYn != null and codYn != ''">
			cod_yn = #{codYn}
			</if>
		</where>
	</select>
	
	<!-- 공통코드 신규 행 추가 -->
	<insert id="insertCodes">
		INSERT INTO CODE (
			COD_ID,
			COD_NM,
			COD_YN,
			COD_REG_TIME
		)
		VALUES
		<foreach collection="list" item="code" separator=",">
			(
				#{code.cod_id},
				#{code.cod_nm},
				#{code.cod_yn},
				sysdate
			)
		</foreach>
	</insert>
	
	<!-- 공통코드 기존 행 수정 -->
	<update id="updateCodes">
		<foreach collection="list" item="code" separator=";">
			UPDATE CODE
			SET
			COD_NM = #{code.cod_nm},
			COD_YN = #{code.cod_yn}
			WHERE
			COD_ID = #{code.cod_id}
		</foreach>
	</update>
</mapper>